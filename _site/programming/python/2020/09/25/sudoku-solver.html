<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Solving Sudoku puzzles in style with Python | kbairak’s blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Solving Sudoku puzzles in style with Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ok, First things first: Writing a Sudoku solver is not a particularly impressive feat. This post is about how to model this problem and how Python can help with that. After we write the Soduku solver, we will demonstrate some of the tricks we learned into other domains." />
<meta property="og:description" content="Ok, First things first: Writing a Sudoku solver is not a particularly impressive feat. This post is about how to model this problem and how Python can help with that. After we write the Soduku solver, we will demonstrate some of the tricks we learned into other domains." />
<link rel="canonical" href="https://kbairak.github.io/programming/python/2020/09/25/sudoku-solver.html" />
<meta property="og:url" content="https://kbairak.github.io/programming/python/2020/09/25/sudoku-solver.html" />
<meta property="og:site_name" content="kbairak’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-25T20:00:00+03:00" />
<script type="application/ld+json">
{"headline":"Solving Sudoku puzzles in style with Python","dateModified":"2020-09-25T20:00:00+03:00","datePublished":"2020-09-25T20:00:00+03:00","url":"https://kbairak.github.io/programming/python/2020/09/25/sudoku-solver.html","@type":"BlogPosting","description":"Ok, First things first: Writing a Sudoku solver is not a particularly impressive feat. This post is about how to model this problem and how Python can help with that. After we write the Soduku solver, we will demonstrate some of the tricks we learned into other domains.","mainEntityOfPage":{"@type":"WebPage","@id":"https://kbairak.github.io/programming/python/2020/09/25/sudoku-solver.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://kbairak.github.io/feed.xml" title="kbairak's blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">kbairak&#39;s blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Solving Sudoku puzzles in style with Python</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-09-25T20:00:00+03:00" itemprop="datePublished">Sep 25, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Ok, First things first: Writing a Sudoku solver is not a particularly
impressive feat. This post is about how to model this problem and how Python
can help with that. After we write the Soduku solver, we will demonstrate some
of the tricks we learned into other domains.</p>

<p>Lets start by talking a bit about slices.</p>

<h2 id="slices">Slices</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="n">start</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">step</span>
<span class="c1"># &gt;&gt;&gt; (1, 2, 3)
</span></code></pre></div></div>

<p>This doesn’t look very impressive. <code class="language-plaintext highlighter-rouge">slice</code> is a Python built-in, yet it doesn’t
seem to accomplish anything more than a <code class="language-plaintext highlighter-rouge">namedtuple</code> would. So, why does it
exist? To find out, lets try something:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Slicer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">index</span>

<span class="n">slicer</span> <span class="o">=</span> <span class="n">Slicer</span><span class="p">()</span>
<span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; 1
</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="c1"># &gt;&gt;&gt; slice(1, None, None)
</span><span class="n">slicer</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; slice(None, 2, None)
</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; slice(1, 2, None)
</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; slice(1, 2, 3)
</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; slice(1, None, 3)
</span><span class="n">slicer</span><span class="p">[:</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; slice(None, 2, 3)
</span><span class="n">slicer</span><span class="p">[::</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; slice(None, None, 3)
</span><span class="n">slicer</span><span class="p">[:]</span>
<span class="c1"># &gt;&gt;&gt; slice(None, None, None)
</span></code></pre></div></div>

<p>So, the square-bracket notation will invoke <code class="language-plaintext highlighter-rouge">__getitem__</code> but, before doing
that, it will convert the <code class="language-plaintext highlighter-rouge">a:b:c</code> notation into a <code class="language-plaintext highlighter-rouge">slice(a, b, c)</code> constructor.</p>

<p>Another related trick is that indexes, ie arguments to the square bracket
notation, can be pairs of things:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; (1, 2)
</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; (1, 2, 3)
</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; (1, slice(2, 3, None))
</span></code></pre></div></div>

<p>This particular trick, however, is much less impressive since in Python it’s
the comma (<code class="language-plaintext highlighter-rouge">,</code>) that makes a tuple and not the parentheses. This is why return
statements with more than one values work as they do:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">foo</span><span class="p">()</span>
<span class="c1"># &gt;&gt;&gt; (1, 2)
</span></code></pre></div></div>

<p>and why dangling commas can ruin your day:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="c1"># &gt;&gt;&gt; False
</span><span class="n">a</span>
<span class="c1"># &gt;&gt;&gt; (1,)
</span></code></pre></div></div>

<p>Ok. Enough with slices and indexes. Back to Sudoku.</p>

<h2 id="modeling-a-sudoku-puzzle">Modeling a Sudoku puzzle</h2>

<p>Lets get started. This is a class that represents a Sudoku puzzle:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Sudoku</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
</code></pre></div></div>

<p>(<a href="https://xkcd.com/1745/">Record scratch</a>) Wait, a list? Shouldn’t we represent a Sudoku puzzle
as a two-dimensional list?</p>

<p>Well, here’s the issue: Sometimes it is better to treat a Sudoku puzzle as a
two-dimensional list, for example when you are verifying that no <code class="language-plaintext highlighter-rouge">3</code>s exist
in the same row, and sometimes as a one-dimensional list, for example when you
are iterating over every cell in the puzzle. So, which should it be?</p>

<p>My answer is (… drumroll …) <strong>both</strong>, almost. We <em>store</em> it as a
one-dimensional list, which is why we simply inherit from <code class="language-plaintext highlighter-rouge">list</code>. But, when we
<em>access</em> it, we can do it either as a one-dimensional or a two-dimensional
list. Lets see how this works:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Sudoku</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">().</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">9</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span> <span class="o">*</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>  <span class="c1"># 0, 9, 18, ...
</span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rows</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span>
</code></pre></div></div>

<p>So, if our index is a number or a slice, we will go to the
<code class="language-plaintext highlighter-rouge">super().__getitem__(index)</code> line and we will be treating the object like a
one-dimensional list:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="n">Sudoku</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">81</span><span class="p">))</span>
<span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; 3
</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; [3, 4, 5, 6, 7, 8]
</span></code></pre></div></div>

<p><em>(Notice how we don’t even have to write an <code class="language-plaintext highlighter-rouge">__init__</code> method. <code class="language-plaintext highlighter-rouge">list</code>’s
initialization works just fine)</em></p>

<p>but if our index is a pair, the object will be split into rows and we will
access them as a two-dimensional list:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get the 3rd cell of the 2nd row
</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; 11
</span></code></pre></div></div>

<p>The best part is that we can use slices for any of the coordinates:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get the 1st row
</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1"># &gt;&gt;&gt; [0, 1, 2, 3, 4, 5, 6, 7, 8]
</span>
<span class="c1"># Get the 1st column
</span><span class="n">s</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; [0, 9, 18, 27, 36, 45, 54, 63, 72]
</span>
<span class="c1"># Get part of the 4th row
</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; [30, 31, 32, 33]
</span>
<span class="c1"># Get the bottom-left 3x3 "box"
</span><span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; [[54, 55, 56],
# ...  [63, 64, 65],
# ...  [72, 73, 74]]
</span></code></pre></div></div>

<p>And we can pretty-print our puzzle without any extra code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">[:,</span> <span class="p">:]</span>
<span class="c1"># &gt;&gt;&gt; [[0,  1,  2,  3,  4,  5,  6,  7,  8 ],
# ...  [9,  10, 11, 12, 13, 14, 15, 16, 17],
# ...  [18, 19, 20, 21, 22, 23, 24, 25, 26],
# ...  [27, 28, 29, 30, 31, 32, 33, 34, 35],
# ...  [36, 37, 38, 39, 40, 41, 42, 43, 44],
# ...  [45, 46, 47, 48, 49, 50, 51, 52, 53],
# ...  [54, 55, 56, 57, 58, 59, 60, 61, 62],
# ...  [63, 64, 65, 66, 67, 68, 69, 70, 71],
# ...  [72, 73, 74, 75, 76, 77, 78, 79, 80]]
</span></code></pre></div></div>

<p><em>(By the way, this way of accessing rows, columns and boxes should feel very
familiar to you if you’ve worked with NumPy)</em></p>

<h2 id="validation">Validation</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Sudoku</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="c1"># __getitem__
</span>
    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Verifies that `self` follows the rules of a Sudoku puzzle. """</span>

        <span class="c1"># Make sure size is correct
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">9</span> <span class="o">*</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c1"># Make sure all digits are between 0 and 9
</span>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c1"># Rows
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">_check_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">))):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c1"># Columns
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">_check_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">))):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c1"># 3x3 boxes
</span>        <span class="k">for</span> <span class="n">row_start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>  <span class="c1"># 0, 3, 6
</span>            <span class="k">for</span> <span class="n">column_start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>  <span class="c1"># 0, 3, 6
</span>                <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">row_start</span><span class="p">:</span><span class="n">row_start</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
                           <span class="n">column_start</span><span class="p">:</span><span class="n">column_start</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>
                <span class="n">flattened_box</span> <span class="o">=</span> <span class="p">[</span><span class="n">number</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">box</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">_check_unique</span><span class="p">(</span><span class="n">flattened_box</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_unique</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
        <span class="s">""" Verifies that each number in `numbers` apart from `0` appears at
            most once.
        """</span>

        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">number</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">numbers</span> <span class="k">if</span> <span class="n">number</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
</code></pre></div></div>

<p>The “dual nature” of our Sudoku puzzle representation really shines here. We
can do things like <code class="language-plaintext highlighter-rouge">len(self)</code> and <code class="language-plaintext highlighter-rouge">set(self)</code> which treat <code class="language-plaintext highlighter-rouge">self</code> as a
one-dimensional list and we can resolve rows, columns and 3x3 boxes by treating
<code class="language-plaintext highlighter-rouge">self</code> as a two-dimensional list.</p>

<h2 id="recursion">Recursion</h2>

<p>Now lets actually solve the puzzle. We won’t do anything fancier that a simple
brute-force solution, ie try every possible value for all cells that have <code class="language-plaintext highlighter-rouge">0</code>
(ie are empty) until either the puzzle becomes invalid or full.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Sudoku</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="c1"># __getitem__, is_valid, _check_unique
</span>
    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Recursively solve the puzzle. If the current version is invalid or
            we can't solve any "descendant", return `None`. If there are no
            empty cells left, return `self`. If a descendant can get solved,
            return the solution.

            - A "descendant" is a slightly modified copy of `self` where the
              first empty cell is replaced with all numbers between 1 and 9
        """</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># We ran out of empty cells, this is a complete, valid puzzle
</span>            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">empty_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>  <span class="c1"># 1, 2, ... 9
</span>            <span class="n">descendant</span> <span class="o">=</span> <span class="n">Sudoku</span><span class="p">(</span><span class="bp">self</span><span class="p">[:</span><span class="n">empty_pos</span><span class="p">]</span> <span class="o">+</span>
                                <span class="p">[</span><span class="n">candidate</span><span class="p">]</span> <span class="o">+</span>
                                <span class="bp">self</span><span class="p">[</span><span class="n">empty_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
            <span class="n">solved</span> <span class="o">=</span> <span class="n">descendant</span><span class="p">.</span><span class="n">solve</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">solved</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">solved</span>

        <span class="c1"># We ran out of candidates, none worked
</span>        <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<p>This method isn’t the most sophisticated or impressive thing I’ve ever written.
What I want to draw attention to here is how being able to treat the puzzle as
a one-dimensional list makes things very easy and elegant while each statement
makes its purpose very clear:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pos = self.index(0)</code> to find the first empty cell</li>
  <li><code class="language-plaintext highlighter-rouge">descendant = Sudoku(self[:pos] + [candidate] + self[pos + 1:])</code> to make a
copy where the cell in position <code class="language-plaintext highlighter-rouge">pos</code> is replaced with <code class="language-plaintext highlighter-rouge">candidate</code></li>
</ul>

<h2 id="demo-time">Demo time</h2>

<p>You can copy paste the code and run it yourselves, but here it is in action:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">puzzle</span> <span class="o">=</span> <span class="n">Sudoku</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>
                 <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
                 <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">solved</span> <span class="o">=</span> <span class="n">puzzle</span><span class="p">.</span><span class="n">solve</span><span class="p">()</span>  <span class="c1"># 1.81 seconds
</span><span class="n">solved</span><span class="p">[:,</span> <span class="p">:]</span>
<span class="c1"># &gt;&gt;&gt; [[1, 4, 5, 7, 2, 6, 3, 9, 8],
# ...  [8, 9, 7, 5, 1, 3, 2, 4, 6],
# ...  [3, 2, 6, 9, 4, 8, 1, 7, 5],
# ...  [2, 1, 9, 3, 7, 5, 8, 6, 4],
# ...  [6, 7, 3, 8, 9, 4, 5, 1, 2],
# ...  [4, 5, 8, 1, 6, 2, 7, 3, 9],
# ...  [7, 8, 1, 4, 5, 9, 6, 2, 3],
# ...  [5, 6, 4, 2, 3, 1, 9, 8, 7],
# ...  [9, 3, 2, 6, 8, 7, 4, 5, 1]]
</span></code></pre></div></div>

<h2 id="other-uses-of-__getitem__-and-slices">Other uses of <code class="language-plaintext highlighter-rouge">__getitem__</code> and slices</h2>

<p>This section is just for inspiration. Keep in mind that there is nothing we do
here that can’t be done without using <code class="language-plaintext highlighter-rouge">__getitem__</code> and slices. My argument is
that the resulting code looks more natural while being very descriptive of its
purpose. We are essentially accessing “virtual lists” that generate their
contents the moment we ask for them.</p>

<h3 id="fixtures-for-testing-jsonapi-responses">Fixtures for testing {json:api} responses</h3>

<p>If you’ve worked with {json:api}, you know that the server responses look like
this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"articles"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Article 1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-01"</span><span class="p">},</span><span class="w">
           </span><span class="nl">"relationships"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"users"</span><span class="p">,</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w">
                                        </span><span class="nl">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"related"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/users/1"</span><span class="p">,</span><span class="w">
                                                  </span><span class="nl">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/articles/1/relationships/author"</span><span class="p">}}},</span><span class="w">
           </span><span class="nl">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/articles/1"</span><span class="p">}},</span><span class="w">
          </span><span class="p">{</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"articles"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Article 2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-09-02"</span><span class="p">},</span><span class="w">
           </span><span class="nl">"relationships"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"users"</span><span class="p">,</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w">
                                        </span><span class="nl">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"related"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/users/2"</span><span class="p">,</span><span class="w">
                                                  </span><span class="nl">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/articles/2/relationships/author"</span><span class="p">},</span><span class="w">
           </span><span class="nl">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/articles/1"</span><span class="p">}}}}],</span><span class="w">
 </span><span class="nl">"included"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"users"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User 1"</span><span class="p">},</span><span class="w">
               </span><span class="nl">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/users/1"</span><span class="p">}},</span><span class="w">
              </span><span class="p">{</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"users"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User 2"</span><span class="p">},</span><span class="w">
               </span><span class="nl">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/users/2"</span><span class="p">}}],</span><span class="w">
 </span><span class="nl">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"self"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/articles"</span><span class="p">}}</span><span class="w">
</span></code></pre></div></div>

<p>The advantages of an API having such detailed responses are many, but having to
write these by hand for unit-tests is very frustrating (I should know, I just
did it). Thankfully, writing a function that creates these is relatively easy.
Lets give it a shot:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">JsonApiFixtures</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plural_type</span><span class="p">,</span> <span class="n">singular_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">singular_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">singular_type</span> <span class="o">=</span> <span class="n">plural_type</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># items =&gt; item
</span>        <span class="k">if</span> <span class="n">extra</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">plural_type</span> <span class="o">=</span> <span class="n">plural_type</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">singular_type</span> <span class="o">=</span> <span class="n">singular_type</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">extra</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">extra</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">plural_type</span><span class="p">,</span>
                  <span class="s">'id'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                  <span class="s">'attributes'</span><span class="p">:</span> <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="p">(</span><span class="s">"{} {}"</span><span class="p">.</span>
                                          <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">singular_type</span><span class="p">,</span> <span class="n">i</span><span class="p">))}}</span>
        <span class="n">result</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">extra</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">index</span><span class="p">.</span><span class="n">start</span> <span class="k">if</span> <span class="n">index</span><span class="p">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">index</span><span class="p">.</span><span class="n">stop</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">index</span><span class="p">.</span><span class="n">step</span> <span class="k">if</span> <span class="n">index</span><span class="p">.</span><span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">_get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">items</span> <span class="o">=</span> <span class="n">JsonApiFixtures</span><span class="p">(</span><span class="s">'items'</span><span class="p">)</span>
<span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; {'type': "items", 'id': "1", 'attributes': {'name': "item 1"}}
</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; [{'type': "items", 'id': "1", 'attributes': {'name': "item 1"}},
# ...  {'type': "items", 'id': "2", 'attributes': {'name': "item 2"}},
# ...  {'type': "items", 'id': "3", 'attributes': {'name': "item 3"}}]
</span>

<span class="n">articles</span> <span class="o">=</span> <span class="n">JsonApiFixtures</span><span class="p">(</span>
    <span class="s">'articles'</span><span class="p">,</span>
    <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s">'relationships'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'author'</span><span class="p">:</span> <span class="p">{</span><span class="s">'data'</span><span class="p">:</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">"users"</span><span class="p">,</span> <span class="s">'id'</span><span class="p">:</span> <span class="s">"1"</span><span class="p">},</span>
                   <span class="s">'links'</span><span class="p">:</span> <span class="p">{</span><span class="s">'self'</span><span class="p">:</span> <span class="s">"/articles/1/relationships/author"</span><span class="p">,</span>
                             <span class="s">'related'</span><span class="p">:</span> <span class="s">"/users/1"</span><span class="p">}},</span>
    <span class="p">}}</span>
<span class="p">)</span>

<span class="n">articles</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># &gt;&gt;&gt; [{'type': "articles",
# ...   'id': "1",
# ...   'attributes': {'name': "article 1"},
# ...   'relationships': {'author': {'data': {'type': "users", 'id': "1"},
# ...                                'links': {'self': "/articles/1/relationships/author",
# ...                                          'related': "/users/1"}}}},
# ...   {'type': "articles",
# ...    'id': "1",
# ...    'attributes': {'name': "article 1"},
# ...    'relationships': {'author': {'data': {'type': "users", 'id': "1"},
# ...                                 'links': {'self': "/articles/1/relationships/author",
# ...                                           'related': "/users/1"}}}}]
</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">test_client</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/articles?filter[odd]=True'</span><span class="p">).</span><span class="n">json</span><span class="p">()[</span><span class="s">'data'</span><span class="p">]</span> <span class="o">==</span>
        <span class="n">articles</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="fixtures-for-testing-django-orm-objects">Fixtures for testing Django ORM objects</h3>

<p>Aka “poor man’s <a href="https://factoryboy.readthedocs.io/en/latest/">factory-boy</a>”. This time we will dive straight
into the code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DjangoOrmFixtures</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="p">.</span><span class="n">kwargs</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">kwargs</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">index</span><span class="p">.</span><span class="n">start</span> <span class="ow">or</span> <span class="mi">1</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">index</span><span class="p">.</span><span class="n">stop</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">index</span><span class="p">.</span><span class="n">step</span> <span class="ow">or</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">_get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ArticleFixtures</span> <span class="o">=</span> <span class="n">DjangoOrmFixtures</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span>
                                    <span class="n">slug</span><span class="o">=</span><span class="s">"article-{}"</span><span class="p">,</span>
                                    <span class="n">title</span><span class="o">=</span><span class="s">"Article {}"</span><span class="p">,</span>
                                    <span class="n">content</span><span class="o">=</span><span class="s">"Content of article {}"</span><span class="p">)</span>
<span class="n">UserFixtures</span> <span class="o">=</span> <span class="n">DjangoOrmFixtures</span><span class="p">(</span><span class="n">User</span><span class="p">,</span>
                                 <span class="n">username</span><span class="o">=</span><span class="s">"author-{}"</span><span class="p">,</span>
                                 <span class="n">first_name</span><span class="o">=</span><span class="s">"Author{}"</span><span class="p">,</span>
                                 <span class="n">last_name</span><span class="o">=</span><span class="s">"Authoropoulos{}"</span><span class="p">)</span>

<span class="n">author</span> <span class="o">=</span> <span class="n">UserFixtures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">articles</span> <span class="o">=</span> <span class="n">ArticleFixtures</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div></div>


  </div><a class="u-url" href="/programming/python/2020/09/25/sudoku-solver.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">kbairak&#39;s blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">kbairak&#39;s blog</li><li><a class="u-email" href="mailto:ikijob@gmail.com">ikijob@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/kbairak"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">kbairak</span></a></li><li><a href="https://www.twitter.com/kbairak"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">kbairak</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Mostly programming tips and tutorials, mostly in Python. But who knows? I may rumble about other things as well.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
