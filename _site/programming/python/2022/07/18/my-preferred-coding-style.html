<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>My preferred coding style | kbairak’s blog</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="My preferred coding style" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Lets start with a game. I will pose a question. Then I will write a short story with the answer to that question. Your task is to find the answer as soon as possible. Ready? Go!" />
<meta property="og:description" content="Lets start with a game. I will pose a question. Then I will write a short story with the answer to that question. Your task is to find the answer as soon as possible. Ready? Go!" />
<link rel="canonical" href="https://kbairak.github.io/programming/python/2022/07/18/my-preferred-coding-style.html" />
<meta property="og:url" content="https://kbairak.github.io/programming/python/2022/07/18/my-preferred-coding-style.html" />
<meta property="og:site_name" content="kbairak’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-18T19:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="My preferred coding style" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-18T19:00:00+03:00","datePublished":"2022-07-18T19:00:00+03:00","description":"Lets start with a game. I will pose a question. Then I will write a short story with the answer to that question. Your task is to find the answer as soon as possible. Ready? Go!","headline":"My preferred coding style","mainEntityOfPage":{"@type":"WebPage","@id":"https://kbairak.github.io/programming/python/2022/07/18/my-preferred-coding-style.html"},"url":"https://kbairak.github.io/programming/python/2022/07/18/my-preferred-coding-style.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://kbairak.github.io/feed.xml" title="kbairak&apos;s blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">kbairak&#39;s blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">My preferred coding style</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-07-18T19:00:00+03:00" itemprop="datePublished">Jul 18, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Lets start with a game. I will pose a question. Then I will write a short story
with the answer to that question. Your task is to find the answer as soon as
possible. Ready? Go!</p>

<p>Here is the question:</p>

<blockquote>
  <p>What did the fourth daughter do?</p>
</blockquote>

<p>And now the story:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A man had five daughters. The first daughter
    went to the market. The second daughter
got married. The third daughter
    broke her ankle. The fourth daughter
visited her cousins. The fifth daughter
    played the piano.
</code></pre></div></div>

<p>Ok. Well done! Lets try that again now. Same question, different short story,
different answer:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A man had five daughters.
    The first daughter went to the market.
    The second daughter broke her ankle.
    The third daughter visited her cousins.
    The fourth daughter got married.
    The fifth daughter played the piano.
</code></pre></div></div>

<p>You probably didn’t time yourself during this game, but I would bet that you
were able to find the answer faster with the second short story. So, what was
the point of all this?</p>

<p>Too often in Django, you will see an ORM query written like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SomeModel</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">select_for_update</span><span class="p">().</span><span class="nb">filter</span><span class="p">(</span>
    <span class="n">parent__parent__name</span><span class="o">=</span><span class="s">"Babis"</span><span class="p">,</span>
    <span class="n">parent__other_parent</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">"myparent"</span><span class="p">),</span>
<span class="p">).</span><span class="n">exclude</span><span class="p">(</span><span class="n">married</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">values</span><span class="p">(</span><span class="s">"status"</span><span class="p">).</span><span class="n">annotate</span><span class="p">(</span>
    <span class="n">Count</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span>
<span class="p">).</span><span class="n">order_by</span><span class="p">(</span><span class="s">"-id__count"</span><span class="p">)</span>
</code></pre></div></div>

<p>In fact, sadly, this is exactly how <a href="https://github.com/psf/black">Black</a> will
format the above snippet.</p>

<p>My preferred style for this exact statement would be:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SomeModel</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span>\
    <span class="n">select_for_update</span><span class="p">().</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="n">parent__parent__name</span><span class="o">=</span><span class="s">"Babis"</span><span class="p">,</span>
           <span class="n">parent__other_parent</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">"myparent"</span><span class="p">)).</span>\
    <span class="n">exclude</span><span class="p">(</span><span class="n">married</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span>\
    <span class="n">values</span><span class="p">(</span><span class="s">"status"</span><span class="p">).</span>\
    <span class="n">annotate</span><span class="p">(</span><span class="n">Count</span><span class="p">(</span><span class="s">"id"</span><span class="p">)).</span>\
    <span class="n">order_by</span><span class="p">(</span><span class="s">"-id__count"</span><span class="p">)</span>
</code></pre></div></div>

<p>Notice how each line tells part of a story which makes the whole thing easier
to read. In fact, let me annotate this with comments to illustrate this better:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Ok, we are about to make a query now
</span><span class="n">SomeModel</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span>\
    <span class="c1"># We are locking the rows we will retrieve until the end of the transaction
</span>    <span class="n">select_for_update</span><span class="p">().</span>\
    <span class="c1"># Here are our filters; filter no 1
</span>    <span class="nb">filter</span><span class="p">(</span><span class="n">parent__parent__name</span><span class="o">=</span><span class="s">"Babis"</span><span class="p">,</span>
           <span class="c1"># Filter no 2
</span>           <span class="n">parent__other_parent</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">"myparent"</span><span class="p">)).</span>\
    <span class="c1"># Now we are excluding something
</span>    <span class="n">exclude</span><span class="p">(</span><span class="n">married</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span>\
    <span class="c1"># We are only interested in the 'status' field
</span>    <span class="n">values</span><span class="p">(</span><span class="s">"status"</span><span class="p">).</span>\
    <span class="c1"># Or rather, we are grouping by the status field and are counting IDs per
</span>    <span class="c1"># distinct 'status'
</span>    <span class="n">annotate</span><span class="p">(</span><span class="n">Count</span><span class="p">(</span><span class="s">"id"</span><span class="p">)).</span>\
    <span class="c1"># And finally we order by ID count, descending
</span>    <span class="n">order_by</span><span class="p">(</span><span class="s">"-id__count"</span><span class="p">)</span>
</code></pre></div></div>

<p>But we don’t really need the comments. The code speaks for itself.</p>

<p>To drive the point further home, look at how ridiculus this looks:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SomeModel</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">function1</span><span class="p">().</span><span class="n">function2</span><span class="p">(</span>
    <span class="n">function2_argument1</span><span class="p">,</span>
    <span class="n">function2_argument2</span><span class="p">,</span>
<span class="p">).</span><span class="n">function3</span><span class="p">(</span><span class="n">function3_argument</span><span class="p">).</span><span class="n">function4</span><span class="p">(</span><span class="n">function4_argument</span><span class="p">).</span><span class="n">function5</span><span class="p">(</span>
    <span class="n">function5_argument</span>
<span class="p">).</span><span class="n">function6</span><span class="p">(</span><span class="n">function6_argument</span><span class="p">)</span>
</code></pre></div></div>
<p>Compared to this</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SomeModel</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span>\
    <span class="n">function1</span><span class="p">().</span>\
    <span class="n">function2</span><span class="p">(</span><span class="n">function2_argument1</span><span class="p">,</span>
              <span class="n">function2_argument2</span><span class="p">).</span>\
    <span class="n">function3</span><span class="p">(</span><span class="n">function3_argument</span><span class="p">).</span>\
    <span class="n">function4</span><span class="p">(</span><span class="n">function4_argument</span><span class="p">).</span>\
    <span class="n">function5</span><span class="p">(</span><span class="n">function5_argument</span><span class="p">).</span>\
    <span class="n">function6</span><span class="p">(</span><span class="n">function6_argument</span><span class="p">)</span>
</code></pre></div></div>

<p>Some people can’t stomach the backslashes at the end of lines but I think that
the value we end up getting is immense.</p>

<p>While we are on the subject, take a look at a couple of lines from my examples:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SomeModel</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span>\
    <span class="p">...</span>
    <span class="nb">filter</span><span class="p">(</span><span class="n">parent__parent__name</span><span class="o">=</span><span class="s">"Babis"</span><span class="p">,</span>
           <span class="n">parent__other_parent</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">"myparent"</span><span class="p">)).</span>\
    <span class="p">...</span>
</code></pre></div></div>

<p>which could have been written as:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SomeModel</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span>\
    <span class="p">...</span>
    <span class="nb">filter</span><span class="p">(</span>
        <span class="n">parent__parent__name</span><span class="o">=</span><span class="s">"Babis"</span><span class="p">,</span>
        <span class="n">parent__other_parent</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">"myparent"</span><span class="p">),</span>
    <span class="p">).</span>\
    <span class="p">...</span>
</code></pre></div></div>

<p>I am a strong believer that reading code is a more valuable skill to a
programmer than writing code. The heavier indentation helps guide the eye and
give you insight <strong>without your brain having to make a conscious effort</strong>. The
fact that we are saving a bit on line count is also a bonus since this way you
can fit more of the file on your screen.</p>

<p>This last rule is not so rigid however since I am also a big fan of
<a href="https://peps.python.org/pep-0008/#maximum-line-length">PEP8’s 79-char limit</a>
because I like splitting my screen horizontally to have up to 4 files open at
the same time. So, I will use the heavier indentation when I can, but fall back
to the more conventional approach when the 79-char limit is about to be broken.
So it is possible to see something like this in my code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Base</span><span class="p">.</span>\
    <span class="n">function1</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span>
              <span class="n">arg2</span><span class="p">,</span>
              <span class="n">arg3</span><span class="p">).</span>\
    <span class="n">function2</span><span class="p">(</span>
        <span class="n">very_long_arg1</span><span class="p">,</span>
        <span class="n">very_long_arg2</span><span class="p">,</span>
        <span class="n">very_long_arg2</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>My beliefs around the importance of indentation and on saving on line count
when possible also guide how I write docstrings:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">a_function</span><span class="p">():</span>
    <span class="s">""" Docstring line 1
        Docstring line 2
        Docstring line 3
        Docstring line 4
        Docstring line 5
    """</span>

    <span class="n">code_line_1</span><span class="p">()</span>
    <span class="n">code_line_2</span><span class="p">()</span>
    <span class="n">code_line_3</span><span class="p">()</span>
    <span class="n">code_line_4</span><span class="p">()</span>
    <span class="n">code_line_5</span><span class="p">()</span>
</code></pre></div></div>

  </div><a class="u-url" href="/programming/python/2022/07/18/my-preferred-coding-style.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">kbairak&#39;s blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">kbairak&#39;s blog</li><li><a class="u-email" href="mailto:ikijob@gmail.com">ikijob@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/kbairak"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">kbairak</span></a></li><li><a href="https://www.twitter.com/kbairak"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">kbairak</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Mostly programming tips and tutorials, mostly in Python. But who knows? I may rumble about other things as well.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
